<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; background:#f5f6fa; margin:0; }
header { background:#6c63ff; color:#fff; padding:16px; }
.container { padding:20px; }
.tabs { display:flex; gap:10px; margin-bottom:20px; }
.tab { padding:10px 16px; background:#fff; border-radius:6px; cursor:pointer; border:1px solid #ddd; }
.tab.active { background:#6c63ff; color:#fff; }
.panel { background:#fff; padding:16px; border-radius:8px; }
button { padding:6px 12px; margin:4px; cursor:pointer; }
input { padding:6px; margin:4px; }
.item { border-bottom:1px solid #eee; padding:8px 0; }
</style>
</head>
<body>
<header>
  <h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å Harmony</h2>
</header>

<div class="container">
  <div class="tabs">
    <div class="tab active" data-col="students">–£—á–µ–Ω–∏–∫–∏</div>
    <div class="tab" data-col="teachers">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏</div>
    <div class="tab" data-col="schedules">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</div>
    <div class="tab" data-col="instruments">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</div>
  </div>

  <div id="panel" class="panel">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAVKFwa8SmjzbnWlcGPkzZ4OppiGYNNcN4",
  authDomain: "sait-a53b0.firebaseapp.com",
  projectId: "sait-a53b0",
  storageBucket: "sait-a53b0.firebasestorage.app",
  messagingSenderId: "983380745618",
  appId: "1:983380745618:web:05874c26f76c47cac4754b",
  measurementId: "G-NTVYG8WMV5"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const panel = document.getElementById('panel');
const tabs = document.querySelectorAll('.tab');
let currentCol = 'students';

// üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞
onAuthStateChanged(auth, async user => {
  if (!user) {
    alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏');
    location.href = 'auth.html';
    return;
  }

  const snap = await getDoc(doc(db, 'users', user.uid));
  if (!snap.exists() || snap.data().role !== 'admin') {
    alert('–¢—ã –Ω–µ –∞–¥–º–∏–Ω');
    location.href = 'main.html';
    return;
  }

  loadCollection();
});

// –≤–∫–ª–∞–¥–∫–∏
tabs.forEach(t => t.onclick = () => {
  tabs.forEach(x => x.classList.remove('active'));
  t.classList.add('active');
  currentCol = t.dataset.col;
  loadCollection();
});

// –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
async function loadCollection() {
  panel.innerHTML = `<h3>${currentCol}</h3>`;

  const snap = await getDocs(collection(db, currentCol));

  snap.forEach(d => {
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `<b>${d.id}</b> ‚Äî ${JSON.stringify(d.data())}`;

    const del = document.createElement('button');
    del.textContent = '–£–¥–∞–ª–∏—Ç—å';
    del.onclick = () => deleteDoc(doc(db, currentCol, d.id)).then(loadCollection);

    div.appendChild(del);
    panel.appendChild(div);
  });

  // —Ñ–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
  const form = document.createElement('div');
  form.innerHTML = `
    <h4>–î–æ–±–∞–≤–∏—Ç—å</h4>
    <input id="f1" placeholder="name / title">
    <button id="add">–î–æ–±–∞–≤–∏—Ç—å</button>
  `;

  form.querySelector('#add').onclick = async () => {
    const val = form.querySelector('#f1').value.trim();
    if (!val) return alert('–ø—É—Å—Ç–æ');
    await addDoc(collection(db, currentCol), { name: val, createdAt: Date.now() });
    loadCollection();
  };

  panel.appendChild(form);
}
</script>
</body>
</html>
